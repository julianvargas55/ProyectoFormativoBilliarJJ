package sena.jj.com.controller;

import sena.jj.com.model.Admin;
import sena.jj.com.service.AdminService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import javax.servlet.http.HttpSession; // Necesitas esto para manejar la sesión

@Controller
public class LoginController {

    @Autowired
    private AdminService adminService;

    // Muestra la página de inicio/login (la primera imagen)
    @GetMapping("/")
    public String mostrarLoginPage() {
        return "login"; // Asume que tu archivo HTML se llama 'login.html'
    }

    // Maneja el envío del formulario de administrador
    @PostMapping("/login-admin")
    public String loginAdministrador(
            @RequestParam("nombreDeAdmin") String nombre, 
            @RequestParam("contrasena") String password,
            HttpSession session, 
            Model model) {
        
        Admin admin = adminService.autenticar(nombre, password);

        if (admin != null) {
            // Éxito: Guarda el admin en la sesión y redirige al dashboard
            session.setAttribute("adminLogeado", admin); 
            return "redirect:/administrador"; // Redirige al AdministradorController
            
        } else {
            // Fracaso: Añade un mensaje de error y vuelve a la página de login
            model.addAttribute("errorAdmin", "Credenciales de Administrador incorrectas.");
            return "login";
        }
    }
}